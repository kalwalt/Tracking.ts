!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.Tracking=r():t.Tracking=r()}(this,(()=>(()=>{"use strict";var t={d:(r,e)=>{for(var i in e)t.o(e,i)&&!t.o(r,i)&&Object.defineProperty(r,i,{enumerable:!0,get:e[i]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r)},r={};t.d(r,{default:()=>f});class e{constructor(){}events_=null;addListener(t,r){if("function"!=typeof r)throw new TypeError("Listener must be a function");return this.events_||(this.events_={}),this.emit("newListener",t,r),this.events_[t]||(this.events_[t]=[]),this.events_[t].push(r),this}listeners(t){return this.events_&&this.events_[t]}emit(t,...r){var e=this.listeners(t);if(e){for(var i=Array.prototype.slice.call(arguments,1),n=0;n<e.length;n++)e[n]&&e[n].apply(this,i);return!0}return!1}on=this.addListener;once(t,r){var e=this;e.on(t,(function i(){e.removeListener(t,i),r.apply(this,arguments)}))}removeAllListeners(t){return this.events_?(t?delete this.events_[t]:delete this.events_,this):this}removeListener(t,r){if("function"!=typeof r)throw new TypeError("Listener must be a function");if(!this.events_)return this;var e=this.listeners(t);if(Array.isArray(e)){var i=e.indexOf(r);if(i<0)return this;e.splice(i,1)}return this}setMaxListeners(){throw new Error("Not implemented")}}class i{constructor(){}static loadImage(t,r,e,i,n,a,s){var o=this,h=new window.Image;h.crossOrigin="*",h.onload=function(){var r=t.getContext("2d");t.width=n,t.height=a,r.drawImage(h,e,i,n,a),s&&s.call(o),h=null},h.src=r}}class n{constructor(){}static blur(t,r,e,i){if((i=Math.abs(i))<=1)throw new Error("Diameter should be greater than 1.");for(var a=i/2,s=Math.ceil(i)+(1-Math.ceil(i)%2),o=new Float32Array(s),h=(a+.5)/3,c=h*h,l=1/Math.sqrt(2*Math.PI*c),u=-1/(2*h*h),f=0,g=Math.floor(s/2),v=0;v<s;v++){var m=v-g,d=l*Math.exp(m*m*u);o[v]=d,f+=d}for(var w=0;w<o.length;w++)o[w]/=f;return n.separableConvolve(t,r,e,o,o,!1)}static computeIntegralImage(t,r,e,i,n,a,s){if(arguments.length<4)throw new Error("You should specify at least one output array in the order: sum, square, tilted, sobel.");var o;s&&(o=this.sobel(t,r,e));for(var h=0;h<e;h++)for(var c=0;c<r;c++){var l=h*r*4+4*c,u=~~(.299*t[l]+.587*t[l+1]+.114*t[l+2]);if(i&&this.computePixelValueSAT_(i,r,h,c,u),n&&this.computePixelValueSAT_(n,r,h,c,u*u),a){var f=l-4*r,g=~~(.299*t[f]+.587*t[f+1]+.114*t[f+2]);this.computePixelValueRSAT_(a,r,h,c,u,g||0)}s&&this.computePixelValueSAT_(s,r,h,c,o[l])}}static computePixelValueRSAT_(t,r,e,i,n,a){var s=e*r+i;t[s]=(t[s-r-1]||0)+(t[s-r+1]||0)-(t[s-r-r]||0)+n+a}static computePixelValueSAT_(t,r,e,i,n){var a=e*r+i;t[a]=(t[a-r]||0)+(t[a-1]||0)+n-(t[a-r-1]||0)}static grayscale(t,r,e,i){for(var n=new Uint8ClampedArray(i?t.length:t.length>>2),a=0,s=0,o=0;o<e;o++)for(var h=0;h<r;h++){var c=.299*t[s]+.587*t[s+1]+.114*t[s+2];n[a++]=c,i&&(n[a++]=c,n[a++]=c,n[a++]=t[s+3]),s+=4}return n}static horizontalConvolve(t,r,e,i,n){for(var a=i.length,s=Math.floor(a/2),o=new Float32Array(r*e*4),h=n?1:0,c=0;c<e;c++)for(var l=0;l<r;l++){for(var u=c,f=l,g=4*(c*r+l),v=0,m=0,d=0,w=0,_=0;_<a;_++){var p=4*(u*r+Math.min(r-1,Math.max(0,f+_-s))),y=i[_];v+=t[p]*y,m+=t[p+1]*y,d+=t[p+2]*y,w+=t[p+3]*y}o[g]=v,o[g+1]=m,o[g+2]=d,o[g+3]=w+h*(255-w)}return o}static verticalConvolve(t,r,e,i,n){for(var a=i.length,s=Math.floor(a/2),o=new Float32Array(r*e*4),h=n?1:0,c=0;c<e;c++)for(var l=0;l<r;l++){for(var u=c,f=l,g=4*(c*r+l),v=0,m=0,d=0,w=0,_=0;_<a;_++){var p=4*(Math.min(e-1,Math.max(0,u+_-s))*r+f),y=i[_];v+=t[p]*y,m+=t[p+1]*y,d+=t[p+2]*y,w+=t[p+3]*y}o[g]=v,o[g+1]=m,o[g+2]=d,o[g+3]=w+h*(255-w)}return o}static separableConvolve(t,r,e,i,n,a){var s=this.verticalConvolve(t,r,e,n,a);return this.horizontalConvolve(s,r,e,i,a)}static sobel(t,r,e){for(var i=n.grayscale(t,r,e,!0),a=new Float32Array(r*e*4),s=new Float32Array([-1,0,1]),o=new Float32Array([1,2,1]),h=this.separableConvolve(i,r,e,s,o),c=this.separableConvolve(i,r,e,o,s),l=0;l<a.length;l+=4){var u=h[l],f=c[l],g=Math.sqrt(f*f+u*u);a[l]=g,a[l+1]=g,a[l+2]=g,a[l+3]=255}return a}static equalizeHist(t,r,e){for(var i=new Uint8ClampedArray(t.length),n=new Array(256),a=0;a<256;a++)n[a]=0;for(a=0;a<t.length;a++)i[a]=t[a],n[t[a]]++;var s=n[0];for(a=0;a<256;a++)n[a]+=s,s=n[a];var o=255/t.length;for(a=0;a<t.length;a++)i[a]=n[t[a]]*o+.5|0;return i}}class a extends e{constructor(t){if(super(),!t)throw new Error("Tracker instance not specified.");this.setTracker(t)}tracker_=null;running_=!1;getTracker(){return this.tracker_}inRunning(){return this.running_}setRunning(t){this.running_=t}setTracker(t){this.tracker_=t}run(){var t=this;if(!this.inRunning())return this.setRunning(!0),this.tracker_.on("track",(function(r){t.emit("track",r)})),this.emit("run"),this}stop(){if(this.inRunning()){var t=this;return this.setRunning(!1),this.emit("stop"),this.tracker_.removeListener("track",(function(r){t.emit("track",r)})),this}}}class s extends e{constructor(){super()}}class o{constructor(){}static distance(t,r,e,i){var n=e-t,a=i-r;return globalThis.Math.sqrt(n*n+a*a)}static hammingWeight(t){return 16843009*((t=(858993459&(t-=t>>1&1431655765))+(t>>2&858993459))+(t>>4)&252645135)>>24}static uniformRandom(t,r){return t+globalThis.Math.random()*(r-t)}static intersectRect(t,r,e,i,n,a,s,o){return!(n>e||s<t||a>i||o<r)}}class h extends s{constructor(t){super(),this.initColors(),"string"==typeof t&&(t=[t]),t&&(t.forEach((function(t){if(!h.getColor(t))throw new Error('Color not valid, try `new tracking.ColorTracker("magenta")`.')})),this.setColors(t))}static knownColors_=new Map;static neighbours_=new Map;static registerColor(t,r){h.knownColors_.set(t,r)}static getColor(t){return h.knownColors_.get(t)}colors=["magenta"];minDimension=20;maxDimension=1/0;minGroupSize=30;calculateDimensions_(t,r){for(var e=-1,i=-1,n=1/0,a=1/0,s=0;s<r;s+=2){var o=t[s],h=t[s+1];o<n&&(n=o),o>e&&(e=o),h<a&&(a=h),h>i&&(i=h)}return{width:e-n,height:i-a,x:n,y:a}}getColors(){return this.colors}getMinDimension(){return this.minDimension}getMaxDimension(){return this.maxDimension}getMinGroupSize(){return this.minGroupSize}getNeighboursForWidth_(t){if(h.neighbours_.get(t))return h.neighbours_.get(t);var r=new Int32Array(8);return r[0]=4*-t,r[1]=4*-t+4,r[2]=4,r[3]=4*t+4,r[4]=4*t,r[5]=4*t-4,r[6]=-4,r[7]=4*-t-4,h.neighbours_.set(t,r),r}mergeRectangles_(t){for(var r,e=[],i=this.getMinDimension(),n=this.getMaxDimension(),a=0;a<t.length;a++){var s=t[a];r=!0;for(var h=a+1;h<t.length;h++){var c=t[h];if(o.intersectRect(s.x,s.y,s.x+s.width,s.y+s.height,c.x,c.y,c.x+c.width,c.y+c.height)){r=!1;var l=Math.min(s.x,c.x),u=Math.min(s.y,c.y),f=Math.max(s.x+s.width,c.x+c.width),g=Math.max(s.y+s.height,c.y+c.height);c.height=g-u,c.width=f-l,c.x=l,c.y=u;break}}r&&s.width>=i&&s.height>=i&&s.width<=n&&s.height<=n&&e.push(s)}return e}setColors(t){this.colors=t}setMinDimension(t){this.minDimension=t}setMaxDimension(t){this.maxDimension=t}setMinGroupSize(t){this.minGroupSize=t}track(t,r,e){var i=this,n=this.getColors();if(!n)throw new Error('Colors not specified, try `new tracking.ColorTracker("magenta")`.');var a=[];n.forEach((function(n){a=a.concat(i.trackColor_(t,r,e,n))})),this.emit("track",{data:a})}trackColor_(t,r,e,i){var n,a,s,o,c,l=h.knownColors_.get(i),u=new Int32Array(t.length>>2),f=new Int8Array(t.length),g=this.getMinGroupSize(),v=this.getNeighboursForWidth_(r),m=new Int32Array([-1,-1,0,1,1,1,0,-1]),d=new Int32Array([0,1,1,1,0,-1,-1,-1]),w=new Int32Array(t.length),_=[],p=-4;if(!l)return _;for(var y=0;y<e;y++)for(var k=0;k<r;k++)if(!f[p+=4]){for(n=0,c=-1,w[++c]=p,w[++c]=y,w[++c]=k,f[p]=1;c>=0;)if(s=w[c--],a=w[c--],l(t[o=w[c--]],t[o+1],t[o+2],t[o+3],o,a,s)){u[n++]=s,u[n++]=a;for(var C=0;C<v.length;C++){var x=o+v[C],M=a+m[C],A=s+d[C];!f[x]&&M>=0&&M<e&&A>=0&&A<r&&(w[++c]=x,w[++c]=M,w[++c]=A,f[x]=1)}}if(n>=g){var b=this.calculateDimensions_(u,n);b&&(b.color=i,_.push(b))}}return this.mergeRectangles_(_)}initColors(){h.registerColor("cyan",((t,r,e)=>{var i=t-0,n=r-255,a=e-255;return r-t>=50&&e-t>=70||i*i+n*n+a*a<6400})),h.registerColor("magenta",(function(t,r,e){var i=t-255,n=r-0,a=e-255;return t-r>=50&&e-r>=50||i*i+n*n+a*a<19600})),h.registerColor("yellow",(function(t,r,e){var i=t-255,n=r-255,a=e-0;return t-e>=50&&r-e>=50||i*i+n*n+a*a<1e4}))}}class c{constructor(){this.math=new o,console.log(this.math)}math;static N=512;static randomImageOffsets_=new Map;static randomWindowOffsets_=null;static getDescriptors(t,r,e){for(var i=new Int32Array((e.length>>1)*(this.N>>5)),n=0,a=this.getRandomOffsets_(r),s=0,o=0;o<e.length;o+=2)for(var h=r*e[o+1]+e[o],c=0,l=0,u=this.N;l<u;l++)t[a[c++]+h]<t[a[c++]+h]&&(n|=1<<(31&l)),l+1&31||(i[s++]=n,n=0);return i}static match(t,r,e,i){for(var n=t.length>>1,a=e.length>>1,s=new Array(n),h=0;h<n;h++){for(var c=1/0,l=0,u=0;u<a;u++){for(var f=0,g=0,v=this.N>>5;g<v;g++)f+=o.hammingWeight(r[h*v+g]^i[u*v+g]);f<c&&(c=f,l=u)}s[h]={index1:h,index2:l,keypoint1:[t[2*h],t[2*h+1]],keypoint2:[e[2*l],e[2*l+1]],confidence:1-c/this.N}}return s}static reciprocalMatch(t,r,e,i){var n=[];if(0===t.length||0===e.length)return n;for(var a=this.match(t,r,e,i),s=this.match(e,i,t,r),o=0;o<a.length;o++)s[a[o].index2].index2===o&&n.push(a[o]);return n}static getRandomOffsets_(t){if(!this.randomWindowOffsets_){for(var r=0,e=new Int32Array(4*this.N),i=0;i<this.N;i++)e[r++]=globalThis.Math.round(o.uniformRandom(-15,16)),e[r++]=globalThis.Math.round(o.uniformRandom(-15,16)),e[r++]=globalThis.Math.round(o.uniformRandom(-15,16)),e[r++]=globalThis.Math.round(o.uniformRandom(-15,16));this.randomWindowOffsets_=e}if(!this.randomImageOffsets_.get(t)){for(var n=0,a=new Int32Array(2*this.N),s=0;s<this.N;s++)a[n++]=this.randomWindowOffsets_[4*s]*t+this.randomWindowOffsets_[4*s+1],a[n++]=this.randomWindowOffsets_[4*s+2]*t+this.randomWindowOffsets_[4*s+3];this.randomImageOffsets_.set(t,a)}return this.randomImageOffsets_.get(t)}}class l{constructor(){}static THRESHOLD=40;static circles_=new Map;static findCorners(t,r,e,i=this.THRESHOLD){var n=this.getCircleOffsets_(r),a=new Int32Array(16),s=[];void 0===i&&(i=this.THRESHOLD);for(var o=3;o<e-3;o++)for(var h=3;h<r-3;h++){for(var c=o*r+h,l=t[c],u=0;u<16;u++)a[u]=t[c+n[u]];this.isCorner(l,a,i)&&(s.push(h,o),h+=3)}return s}static isBrighter(t,r,e){return t-r>e}static isCorner(t,r,e){if(this.isTriviallyExcluded(r,t,e))return!1;for(var i=0;i<16;i++){for(var n=!0,a=!0,s=0;s<9;s++){var o=r[i+s&15];if(!this.isBrighter(t,o,e)&&(a=!1,!1===n))break;if(!this.isDarker(t,o,e)&&(n=!1,!1===a))break}if(a||n)return!0}return!1}static isDarker(t,r,e){return r-t>e}static isTriviallyExcluded(t,r,e){var i=0,n=t[8],a=t[12],s=t[4],o=t[0];return this.isBrighter(o,r,e)&&i++,this.isBrighter(s,r,e)&&i++,this.isBrighter(n,r,e)&&i++,this.isBrighter(a,r,e)&&i++,i<3&&(i=0,this.isDarker(o,r,e)&&i++,this.isDarker(s,r,e)&&i++,this.isDarker(n,r,e)&&i++,this.isDarker(a,r,e)&&i++,i<3)}static getCircleOffsets_(t){if(l.circles_.get(t))return l.circles_.get(t);var r=new Int32Array(16);return r[0]=-t-t-t,r[1]=r[0]+1,r[2]=r[1]+t+1,r[3]=r[2]+t+1,r[4]=r[3]+t,r[5]=r[4]+t,r[6]=r[5]+t-1,r[7]=r[6]+t-1,r[8]=r[7]-1,r[9]=r[8]-1,r[10]=r[9]-t-1,r[11]=r[10]-t-1,r[12]=r[11]-t,r[13]=r[12]-t,r[14]=r[13]-t+1,r[15]=r[14]-t+1,l.circles_.set(t,r),r}}class u{static EventEmitter;static Canvas;static Image;static ColorTracker;static Brief;static Fast;static grayscale;static blur;constructor(){}initUserMedia_(t,r){window.navigator.mediaDevices.getUserMedia({video:!0,audio:!(!r||!r.audio)}).then((function(r){t.srcObject=r})).catch((function(t){throw Error("Cannot capture user camera.")}))}isNode(t){return t.nodeType||this.isWindow(t)}isWindow(t){return!!(t&&t.alert&&t.document)}one(t,r){return this.isNode(t)?t:(r||document).querySelector(t)}track(t,r,e){if(!(t=this.one(t)))throw new Error("Element not found, try a different element or selector.");if(!r)throw new Error("Tracker not specified, try `tracking.track(element, new tracking.FaceTracker())`.");switch(t.nodeName.toLowerCase()){case"canvas":return this.trackCanvas_(t,r,e);case"img":return this.trackImg_(t,r,e);case"video":return e&&e.camera&&this.initUserMedia_(t,e),this.trackVideo_(t,r,e);default:throw new Error("Element not supported, try in a canvas, img, or video.")}}trackCanvas_(t,r,e){var i=this,n=new a(r);return n.on("run",(function(){i.trackCanvasInternal_(t,r)})),n.run()}trackCanvasInternal_(t,r,e){var i=t.width,n=t.height,a=t.getContext("2d").getImageData(0,0,i,n);r.track(a.data,i,n)}trackImg_(t,r,e){var i=t.width,n=t.height,s=document.createElement("canvas");s.width=i,s.height=n;var o=new a(r);return o.on("run",(()=>{u.Canvas.loadImage(s,t.src,0,0,i,n,(()=>{this.trackCanvasInternal_(s,r)}))})),o.run()}trackVideo_(t,r,e){var i,n,s,o=document.createElement("canvas"),h=o.getContext("2d"),c=function(){i=t.offsetWidth,n=t.offsetHeight,o.width=i,o.height=n};c(),t.addEventListener("resize",c);var l=()=>{s=window.requestAnimationFrame((()=>{if(t.readyState===t.HAVE_ENOUGH_DATA){try{h.drawImage(t,0,0,i,n)}catch(t){}this.trackCanvasInternal_(o,r)}l()}))},u=new a(r);return u.on("stop",(function(){window.cancelAnimationFrame(s)})),u.on("run",(function(){l()})),u.run()}EventEmitter=e;Canvas=i;Image=n;ColorTracker=h;Brief=c;Fast=l}u.EventEmitter=e,u.Canvas=i,u.Image=n,u.ColorTracker=h,u.Brief=c,u.Fast=l;const f={Tracking:u};return r.default})()));